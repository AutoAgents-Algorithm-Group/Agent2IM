# å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ä½¿ç”¨è¯´æ˜

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /Users/forhheart/AIGC/Agent2IM
python backend/playground/start_scheduler.py
```

å¯åŠ¨åä¼šçœ‹åˆ°èœå•ï¼š
```
================================================================================
  é€‰æ‹©æµ‹è¯•æ¨¡å¼
================================================================================
1. æ‰‹åŠ¨è§¦å‘ä»»åŠ¡ï¼ˆç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼‰
2. å¯åŠ¨å®šæ—¶è°ƒåº¦å™¨ï¼ˆæŒ‰é…ç½®æ—¶é—´è‡ªåŠ¨æ‰§è¡Œï¼‰
3. æŸ¥çœ‹é…ç½®ä¿¡æ¯
4. æµ‹è¯•Bitableè¿æ¥
0. é€€å‡º
================================================================================
```

---

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

### 1ï¸âƒ£ æ‰‹åŠ¨è§¦å‘ä»»åŠ¡
- **ç”¨é€”**: ç«‹å³æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œä¸ç­‰å¾…å®šæ—¶æ—¶é—´
- **é€‚ç”¨åœºæ™¯**: æµ‹è¯•ä»»åŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œ
- **å­é€‰é¡¹**:
  - æ™šä¸Š9ç‚¹ç¾¤èŠæé†’ï¼ˆæ£€æŸ¥ä»Šå¤©ï¼‰
  - æ™šä¸Š11ç‚¹ç§ä¿¡æé†’ï¼ˆæ£€æŸ¥ä»Šå¤©ï¼‰
  - æ—©ä¸Š10ç‚¹ç¾¤èŠè¡¥å¡«æé†’ï¼ˆæ£€æŸ¥æ˜¨å¤©ï¼‰

### 2ï¸âƒ£ å¯åŠ¨å®šæ—¶è°ƒåº¦å™¨
- **ç”¨é€”**: æŒ‰ç…§ `task.json` é…ç½®çš„æ—¶é—´è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡
- **é€‚ç”¨åœºæ™¯**: å®é™…ç”Ÿäº§ç¯å¢ƒè¿è¡Œ
- **æ³¨æ„**: æŒ‰ `Ctrl+C` å¯ä»¥åœæ­¢è°ƒåº¦å™¨

### 3ï¸âƒ£ æŸ¥çœ‹é…ç½®ä¿¡æ¯
- æ˜¾ç¤ºé£ä¹¦é…ç½®ï¼ˆApp IDã€ç¾¤èŠIDç­‰ï¼‰
- æ˜¾ç¤ºå¤šç»´è¡¨æ ¼é…ç½®
- æ˜¾ç¤ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡
- æ˜¾ç¤ºäººå‘˜åˆ—è¡¨
- æ˜¾ç¤ºæ¶ˆæ¯æ¨¡æ¿

### 4ï¸âƒ£ æµ‹è¯•Bitableè¿æ¥
- æµ‹è¯•å¤šç»´è¡¨æ ¼é…ç½®æ˜¯å¦æ­£ç¡®
- éªŒè¯èƒ½å¦æ­£å¸¸è®¿é—®

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### ğŸ“ backend/config/task.json

```json
{
  "tasks": [
    {
      "id": "task_1",
      "name": "æ™šä¸Š9ç‚¹ç¾¤èŠæé†’",
      "enabled": true,         // â† å¯ç”¨/ç¦ç”¨ä»»åŠ¡
      "time": "21:00",        // â† æ‰§è¡Œæ—¶é—´
      "type": "group_mention",
      "message_template": "evening_first",
      "check_date": "today"
    }
  ],
  "config": {
    "app_id": "cli_xxxxx",              // â† é£ä¹¦åº”ç”¨ID
    "app_secret": "xxxxx",              // â† é£ä¹¦åº”ç”¨å¯†é’¥
    "group_chat_id": "oc_xxxxx",        // â† ç¾¤èŠID
    "form_url": "https://xxx",          // â† è¡¨å•URL
    "bitable_app_token": "bascnxxx",    // â† å¤šç»´è¡¨æ ¼Token
    "bitable_table_id": "tblxxx",       // â† æ•°æ®è¡¨ID
    "timezone": "Asia/Shanghai"         // â† æ—¶åŒº
  }
}
```

### ğŸ“ backend/config/people.json

```json
{
  "people": [
    {
      "id": "001",
      "name": "å¼ ä¸‰",
      "exceptions": ["æ˜ŸæœŸäºŒ"],  // â† ä¾‹å¤–æ—¥æœŸï¼ˆä¸æé†’ï¼‰
      "off": false              // â† æ˜¯å¦è¯·å‡
    }
  ]
}
```

### ğŸ“ backend/config/message.json

æ¶ˆæ¯æ¨¡æ¿é…ç½®ï¼Œå®šä¹‰æé†’æ¶ˆæ¯çš„å†…å®¹å’Œæ ¼å¼ã€‚

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
å¯åŠ¨è°ƒåº¦å™¨
    â†“
åŠ è½½é…ç½®æ–‡ä»¶ (task.json, people.json, message.json)
    â†“
åˆå§‹åŒ–é£ä¹¦æœåŠ¡
    â†“
è®¾ç½®å®šæ—¶ä»»åŠ¡
    â†“
ç­‰å¾…æ‰§è¡Œæ—¶é—´
    â†“
æ‰§è¡Œä»»åŠ¡:
    1. æ£€æŸ¥èŠ‚å‡æ—¥ï¼ˆæ˜¯ â†’ è·³è¿‡ï¼‰
    2. è·å–äººå‘˜åå•ï¼ˆæ’é™¤è¯·å‡å’Œä¾‹å¤–æ—¥æœŸï¼‰
    3. æ£€æŸ¥å¤šç»´è¡¨æ ¼å¡«å†™æƒ…å†µ
    4. å‘æœªå¡«å†™äººå‘˜å‘é€æé†’
    â†“
ç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œ
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥é…ç½®

```bash
python backend/playground/start_scheduler.py
# é€‰æ‹©: 3 (æŸ¥çœ‹é…ç½®ä¿¡æ¯)
```

ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯æ­£ç¡®ï¼š
- âœ… é£ä¹¦App IDå’Œå¯†é’¥
- âœ… ç¾¤èŠID
- âœ… å¤šç»´è¡¨æ ¼é…ç½®
- âœ… äººå‘˜åˆ—è¡¨

### æ­¥éª¤2: æ‰‹åŠ¨æµ‹è¯•ä»»åŠ¡

```bash
python backend/playground/start_scheduler.py
# é€‰æ‹©: 1 (æ‰‹åŠ¨è§¦å‘ä»»åŠ¡)
# é€‰æ‹©: 1 (æ™šä¸Š9ç‚¹ç¾¤èŠæé†’)
```

è§‚å¯Ÿè¾“å‡ºï¼š
- æ˜¯å¦æˆåŠŸè¯»å–é…ç½®
- æ˜¯å¦æ­£ç¡®åˆ¤æ–­èŠ‚å‡æ—¥
- æ˜¯å¦æ­£ç¡®è¿‡æ»¤äººå‘˜
- æ˜¯å¦æˆåŠŸå‘é€æ¶ˆæ¯

### æ­¥éª¤3: å¯åŠ¨å®šæ—¶è°ƒåº¦å™¨

```bash
python backend/playground/start_scheduler.py
# é€‰æ‹©: 2 (å¯åŠ¨å®šæ—¶è°ƒåº¦å™¨)
```

è°ƒåº¦å™¨ä¼šåœ¨åå°è¿è¡Œï¼ŒæŒ‰é…ç½®æ—¶é—´è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹æ‰§è¡Œæ—¶é—´ï¼Ÿ
A: ç¼–è¾‘ `backend/config/task.json`ï¼Œä¿®æ”¹ `time` å­—æ®µï¼š
```json
{
  "time": "09:00"  // æ”¹ä¸ºæ—©ä¸Š9ç‚¹
}
```

### Q: å¦‚ä½•æš‚åœæŸä¸ªä»»åŠ¡ï¼Ÿ
A: ç¼–è¾‘ `backend/config/task.json`ï¼Œè®¾ç½® `enabled: false`ï¼š
```json
{
  "enabled": false  // æš‚åœä»»åŠ¡
}
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„äººå‘˜ï¼Ÿ
A: ç¼–è¾‘ `backend/config/people.json`ï¼Œæ·»åŠ æ–°æ¡ç›®ï¼š
```json
{
  "id": "099",
  "name": "æå››",
  "exceptions": [],
  "off": false
}
```

### Q: èŠ‚å‡æ—¥ä¼šå‘é€æé†’å—ï¼Ÿ
A: ä¸ä¼šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­èŠ‚å‡æ—¥å¹¶è·³è¿‡æé†’ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Ÿ
A: æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œæˆ–é…ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆ`task.json` ä¸­çš„ `log` é…ç½®ï¼‰ã€‚

### Q: ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ï¼š
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. é£ä¹¦åº”ç”¨æƒé™æ˜¯å¦å®Œæ•´
3. é…ç½®ä¿¡æ¯æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

---

## ğŸ“Š ä»»åŠ¡è¯´æ˜

### ä»»åŠ¡1: æ™šä¸Š9ç‚¹ç¾¤èŠæé†’
- **æ—¶é—´**: 21:00
- **æ–¹å¼**: ç¾¤èŠ@æœªå¡«å†™äººå‘˜
- **æ£€æŸ¥**: ä»Šå¤©çš„å¡«å†™æƒ…å†µ
- **ç›®çš„**: é¦–æ¬¡æé†’

### ä»»åŠ¡2: æ™šä¸Š11ç‚¹ç§ä¿¡æé†’
- **æ—¶é—´**: 23:00
- **æ–¹å¼**: ç§ä¿¡æœªå¡«å†™äººå‘˜
- **æ£€æŸ¥**: ä»Šå¤©çš„å¡«å†™æƒ…å†µ
- **ç›®çš„**: äºŒæ¬¡æé†’ï¼ˆæ›´ä¸¥è‚ƒï¼‰

### ä»»åŠ¡3: æ—©ä¸Š10ç‚¹ç¾¤èŠè¡¥å¡«æé†’
- **æ—¶é—´**: 10:00
- **æ–¹å¼**: ç¾¤èŠ@æœªå¡«å†™äººå‘˜
- **æ£€æŸ¥**: æ˜¨å¤©çš„å¡«å†™æƒ…å†µ
- **ç›®çš„**: è¡¥å¡«æé†’

---

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### åå°è¿è¡Œï¼ˆLinux/Macï¼‰

```bash
nohup python backend/playground/start_scheduler.py > scheduler.log 2>&1 &
```

### ä½¿ç”¨systemdï¼ˆLinuxï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/feishu-scheduler.service`:

```ini
[Unit]
Description=Feishu Reminder Scheduler
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/Agent2IM
ExecStart=/usr/bin/python3 backend/playground/start_scheduler.py
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl start feishu-scheduler
sudo systemctl enable feishu-scheduler  # å¼€æœºè‡ªå¯
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é…ç½®å®‰å…¨**: ä¸è¦å°†åŒ…å«å¯†é’¥çš„é…ç½®æ–‡ä»¶æäº¤åˆ°Git
2. **æ—¶åŒºè®¾ç½®**: ç¡®ä¿ `timezone` é…ç½®æ­£ç¡®
3. **æƒé™æ£€æŸ¥**: ç¡®ä¿é£ä¹¦åº”ç”¨æœ‰è¶³å¤Ÿçš„æƒé™
4. **æµ‹è¯•ç¯å¢ƒ**: å»ºè®®å…ˆåœ¨æµ‹è¯•ç¾¤æµ‹è¯•
5. **èŠ‚å‡æ—¥**: ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ä¸­å›½èŠ‚å‡æ—¥

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [BitableåŠŸèƒ½è¯´æ˜](./README_BITABLE.md)
- [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
- [APScheduleræ–‡æ¡£](https://apscheduler.readthedocs.io/)

